import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import styled from 'styled-components';
import SubGenreList from '../components/SubGenreList';
import VideoList from '../components/VideoList';
import AdSpace from '../components/AdSpace';
import axios from 'axios';

const GenrePageContainer = styled.div`
  display: flex;
  justify-content: space-between;
`;

const LeftColumn = styled.div`
  width: 20%;
`;

const CenterColumn = styled.div`
  width: 60%;
`;

const RightColumn = styled.div`
  width: 20%;
`;

const GenrePage = () => {
  const { genreSlug } = useParams();
  const [genre, setGenre] = useState(null);
  const [subGenres, setSubGenres] = useState([]);
  const [videos, setVideos] = useState([]);

  useEffect(() => {
    const fetchGenreData = async () => {
      try {
        const genreResponse = await axios.get(`/api/genres/${genreSlug}`);
        setGenre(genreResponse.data);

        const subGenresResponse = await axios.get(`/api/genres/${genreSlug}/sub-genres`);
        setSubGenres(subGenresResponse.data);

        const videosResponse = await axios.get(`/api/genres/${genreSlug}/videos`);
        setVideos(videosResponse.data);
      } catch (error) {
        console.error('Error fetching genre data:', error);
      }
    };

    fetchGenreData();
  }, [genreSlug]);

  if (!genre) {
    return <div>Loading...</div>;
  }

  return (
    <GenrePageContainer>
      <LeftColumn>
        <SubGenreList subGenres={subGenres} />
      </LeftColumn>
      <CenterColumn>
        <h1>{genre.name}</h1>
        <VideoList videos={videos} />
      </CenterColumn>
      <RightColumn>
        <AdSpace />
      </RightColumn>
    </GenrePageContainer>
  );
};

export default GenrePage;